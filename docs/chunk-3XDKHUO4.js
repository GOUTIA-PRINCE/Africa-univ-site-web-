import{a as y,b as d,c as S,d as F,g as E,j as N,k as I,p as T,r as k,s as G}from"./chunk-LD2MMBCB.js";import{Bb as O,Da as c,Ja as l,Ka as b,La as o,Ma as r,Na as m,Qa as M,R as P,Ra as f,Sa as g,X as _,Xa as n,Y as v,Za as u,pa as w,ra as s,yb as x,za as C}from"./chunk-JEBBGWU2.js";function q(a,e){if(a&1){let i=M();o(0,"img",31),f("error",function(p){let h;_(i);let V=g();return v(p.target.src="https://ui-avatars.com/api/?name="+((h=V.authService.getUser())==null?null:h.firstName))}),r()}if(a&2){let i=g();l("src",i.imagePreview,w)}}function D(a,e){a&1&&m(0,"i",32)}function U(a,e){if(a&1&&(o(0,"div",33),n(1),r()),a&2){let i=g();b("alert-success",!i.profileMessage.startsWith("Erreur")),s(),u(" ",i.profileMessage," ")}}function A(a,e){a&1&&(o(0,"span",34),n(1," Les mots de passe ne correspondent pas "),r())}function j(a,e){if(a&1&&(o(0,"div",33),n(1),r()),a&2){let i=g();b("alert-success",!i.passwordMessage.startsWith("Erreur")),s(),u(" ",i.passwordMessage," ")}}var z=class a{fb=P(T);authService=P(G);profileForm;passwordForm;selectedFile=null;imagePreview=null;profileMessage="";passwordMessage="";loading=!1;ngOnInit(){let e=this.authService.getUser();this.profileForm=this.fb.group({firstName:[e?.firstName||"",d.required],lastName:[e?.lastName||"",d.required],email:[e?.email||"",[d.required,d.email]]}),this.passwordForm=this.fb.group({currentPassword:["",d.required],newPassword:["",[d.required,d.minLength(6)]],confirmPassword:["",d.required]},{validators:this.passwordMatchValidator}),e?.profilePicture&&(this.imagePreview="http://localhost:3000/"+e.profilePicture)}passwordMatchValidator(e){return e.get("newPassword")?.value===e.get("confirmPassword")?.value?null:{mismatch:!0}}onFileSelected(e){let i=e.target.files[0];if(i){this.selectedFile=i;let t=new FileReader;t.onload=()=>this.imagePreview=t.result,t.readAsDataURL(i)}}updateProfile(){this.profileForm.valid&&(this.loading=!0,this.authService.updateProfile(this.profileForm.value,this.selectedFile||void 0).subscribe({next:e=>{this.loading=!1,this.profileMessage="Profil mis \xE0 jour avec succ\xE8s !",this.selectedFile=null,e.user?.profilePicture&&(this.imagePreview="http://localhost:3000/"+e.user.profilePicture),setTimeout(()=>this.profileMessage="",3e3)},error:e=>{this.loading=!1,this.profileMessage="Erreur: "+(e.error?.message||"Inconnue")}}))}updatePassword(){if(this.passwordForm.valid){this.loading=!0;let{currentPassword:e,newPassword:i}=this.passwordForm.value;this.authService.updatePassword({currentPassword:e,newPassword:i}).subscribe({next:()=>{this.loading=!1,this.passwordMessage="Mot de passe modifi\xE9 !",this.passwordForm.reset(),setTimeout(()=>this.passwordMessage="",3e3)},error:t=>{this.loading=!1,this.passwordMessage="Erreur: "+(t.error?.message||"Inconnue")}})}}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=C({type:a,selectors:[["app-profile"]],decls:53,vars:11,consts:[[1,"profile-container"],[1,"profile-card"],[1,"profile-sections"],[1,"profile-section"],[1,"profile-image-edit"],[1,"avatar-large"],["alt","Avatar",3,"src","error",4,"ngIf"],["class","fas fa-user",4,"ngIf"],["for","profileUpload",1,"btn-change-photo"],[1,"fas","fa-camera"],["type","file","id","profileUpload","accept","image/*","hidden","",3,"change"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group","half"],["for","firstName"],["type","text","id","firstName","formControlName","firstName"],["for","lastName"],["type","text","id","lastName","formControlName","lastName"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","email"],["class","alert",3,"alert-success",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled"],["for","currentPassword"],["type","password","id","currentPassword","formControlName","currentPassword"],["for","newPassword"],["type","password","id","newPassword","formControlName","newPassword"],["for","confirmPassword"],["type","password","id","confirmPassword","formControlName","confirmPassword"],["class","error-msg",4,"ngIf"],["type","submit",1,"btn","btn-secondary",3,"disabled"],["alt","Avatar",3,"error","src"],[1,"fas","fa-user"],[1,"alert"],[1,"error-msg"]],template:function(i,t){if(i&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),n(3,"Mon Profil"),r(),o(4,"div",2)(5,"section",3)(6,"h3"),n(7,"Informations Personnelles"),r(),o(8,"div",4)(9,"div",5),c(10,q,1,1,"img",6)(11,D,1,0,"i",7),r(),o(12,"label",8),m(13,"i",9),n(14," Changer la photo "),o(15,"input",10),f("change",function(h){return t.onFileSelected(h)}),r()()(),o(16,"form",11),f("ngSubmit",function(){return t.updateProfile()}),o(17,"div",12)(18,"div",13)(19,"label",14),n(20,"Pr\xE9nom"),r(),m(21,"input",15),r(),o(22,"div",13)(23,"label",16),n(24,"Nom"),r(),m(25,"input",17),r()(),o(26,"div",18)(27,"label",19),n(28,"Email"),r(),m(29,"input",20),r(),c(30,U,2,3,"div",21),o(31,"button",22),n(32),r()()(),o(33,"section",3)(34,"h3"),n(35,"Changer le mot de passe"),r(),o(36,"form",11),f("ngSubmit",function(){return t.updatePassword()}),o(37,"div",18)(38,"label",23),n(39,"Mot de passe actuel"),r(),m(40,"input",24),r(),o(41,"div",18)(42,"label",25),n(43,"Nouveau mot de passe"),r(),m(44,"input",26),r(),o(45,"div",18)(46,"label",27),n(47,"Confirmer le nouveau mot de passe"),r(),m(48,"input",28),c(49,A,2,0,"span",29),r(),c(50,j,2,3,"div",21),o(51,"button",30),n(52),r()()()()()()),i&2){let p;s(10),l("ngIf",t.imagePreview),s(),l("ngIf",!t.imagePreview),s(5),l("formGroup",t.profileForm),s(14),l("ngIf",t.profileMessage),s(),l("disabled",t.loading||t.profileForm.invalid),s(),u(" ",t.loading?"Enregistrement...":"Sauvegarder les modifications"," "),s(4),l("formGroup",t.passwordForm),s(13),l("ngIf",t.passwordForm.hasError("mismatch")&&((p=t.passwordForm.get("confirmPassword"))==null?null:p.touched)),s(),l("ngIf",t.passwordMessage),s(),l("disabled",t.loading||t.passwordForm.invalid),s(),u(" ",t.loading?"Modification...":"Changer le mot de passe"," ")}},dependencies:[O,x,k,E,y,S,F,N,I],styles:[".profile-container[_ngcontent-%COMP%]{padding:3rem 1rem;background-color:#f8fafc;min-height:calc(100vh - 80px)}.profile-card[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;background:#fff;border-radius:16px;padding:2rem;box-shadow:0 4px 6px -1px #0000001a}.profile-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:2rem;color:#1e293b;font-size:2rem;text-align:center}.profile-sections[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem}@media (max-width: 768px){.profile-sections[_ngcontent-%COMP%]{grid-template-columns:1fr}}.profile-section[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border:1px solid #e2e8f0;border-radius:12px}.profile-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:#334155;border-bottom:2px solid #f1f5f9;padding-bottom:.5rem}.profile-image-edit[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:2rem}.profile-image-edit[_ngcontent-%COMP%]   .avatar-large[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;background-color:#f1f5f9;display:flex;align-items:center;justify-content:center;overflow:hidden;border:4px solid #fff;box-shadow:0 0 10px #0000001a;margin-bottom:1rem}.profile-image-edit[_ngcontent-%COMP%]   .avatar-large[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-image-edit[_ngcontent-%COMP%]   .avatar-large[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:#94a3b8}.profile-image-edit[_ngcontent-%COMP%]   .btn-change-photo[_ngcontent-%COMP%]{font-size:.875rem;color:var(--primary-color);cursor:pointer;padding:.5rem 1rem;border:1px solid var(--primary-color);border-radius:20px;transition:all .2s}.profile-image-edit[_ngcontent-%COMP%]   .btn-change-photo[_ngcontent-%COMP%]:hover{background-color:var(--primary-color);color:#fff}.form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.875rem;font-weight:500;color:#64748b}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #cbd5e1;border-radius:8px;font-size:1rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px #e67e221a}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-row[_ngcontent-%COMP%]   .half[_ngcontent-%COMP%]{flex:1}.btn[_ngcontent-%COMP%]{width:100%;padding:.75rem;border-radius:8px;font-weight:600;cursor:pointer;transition:transform .1s}.btn[_ngcontent-%COMP%]:active{transform:scale(.98)}.btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;border:none}.btn-secondary[_ngcontent-%COMP%]{background-color:#64748b;color:#fff;border:none}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#475569}.alert[_ngcontent-%COMP%]{padding:.75rem;border-radius:8px;margin-bottom:1rem;font-size:.875rem}.alert-success[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534;border:1px solid #bbf7d0}.error-msg[_ngcontent-%COMP%]{color:#ef4444;font-size:.75rem;margin-top:.25rem}"]})};export{z as ProfileComponent};
